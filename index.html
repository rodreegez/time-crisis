<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Crisis</title>
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Time Crisis - Mission-Critical Time Tracking">
    <meta property="og:description" content="Track your activities with style and urgency. A sleek, modern time tracking application.">
    <meta property="og:image" content="https://rodreegez.github.io/time-crisis/time-crisis.png">
    <meta property="og:url" content="https://rodreegez.github.io/time-crisis/">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Time Crisis - Mission-Critical Time Tracking">
    <meta name="twitter:description" content="Track your activities with style and urgency. A sleek, modern time tracking application.">
    <meta name="twitter:image" content="https://rodreegez.github.io/time-crisis/time-crisis.png">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }

        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: #ff4d4d;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        form {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        input[type="text"] {
            flex: 1;
            padding: 0.75rem;
            font-size: 1rem;
            border: 2px solid #ff4d4d;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        button:hover {
            background-color: #ff3333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 77, 77, 0.3);
        }

        #activities {
            border-top: 2px solid rgba(255, 77, 77, 0.3);
            padding-top: 1rem;
            position: relative;
        }

        .activity {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .activity.active {
            border-left: 4px solid #ff4d4d;
        }

        .activity.completed {
            border-left: 4px solid #4CAF50;
        }

        .activity:hover {
            transform: translateX(5px);
            z-index: 100;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            color: #fff;
        }

        .timestamp {
            color: #ff4d4d;
            font-size: 0.875rem;
            font-weight: bold;
        }

        .edit-btn, .save-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .edit-btn:hover, .save-btn:hover {
            background-color: #ff3333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 77, 77, 0.3);
        }

        .edit-input {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            border: 2px solid #ff4d4d;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .edit-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        .datetime-input {
            width: 100%;
            padding: 0.5rem;
            font-size: 1rem;
            border: 2px solid #ff4d4d;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
            color: #000;
        }

        .datetime-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }

        .time-adjust-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .time-adjust-btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .time-adjust-btn:hover {
            background-color: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quick-action-btn:hover {
            background-color: #1976D2;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
        }

        .stop-btn {
            background-color: #dc3545;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
        }

        .stop-btn:hover {
            background-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }

        .duration {
            color: #4CAF50;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag {
            background-color: #6c757d;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .tag-remove {
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .tag-input-container {
            position: relative;
            margin-top: 0.5rem;
            z-index: 200;
        }

        .tag-input {
            width: 100%;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border: 1px solid rgba(255, 77, 77, 0.3);
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
        }

        .tag-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .tag-input:focus {
            outline: none;
            border-color: #ff4d4d;
            background: rgba(255, 255, 255, 0.15);
        }

        .tag-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid #ff4d4d;
            border-radius: 4px;
            margin-top: 0.25rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .tag-suggestion {
            padding: 0.5rem;
            cursor: pointer;
            color: white;
        }

        .tag-suggestion:hover {
            background-color: rgba(255, 77, 77, 0.2);
        }

        .tag-summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tag-summary h2 {
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
            color: #ff4d4d;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }

        .tag-summary h2::after {
            content: '▼';
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }

        .tag-summary.collapsed h2::after {
            transform: rotate(-90deg);
        }

        .tag-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
            max-height: 1000px;
        }

        .tag-summary.collapsed .tag-stats {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
        }

        .tag-stat {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 4px;
            border-left: 4px solid;
        }

        .tag-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .tag-stat-name {
            font-weight: bold;
            color: white;
        }

        .tag-stat-time {
            color: #4CAF50;
            font-size: 0.875rem;
        }

        .tag-stat-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .tag-stat-fill {
            height: 100%;
            background: currentColor;
            transition: width 0.3s ease;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        button[type="submit"] {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <h1>Time Crisis</h1>
    
    <form id="activityForm">
        <input type="text" id="activityInput" placeholder="What's your next mission?">
        <button type="submit">Log Mission</button>
    </form>

    <div class="quick-actions">
        <button class="quick-action-btn" data-activity="Design" data-tag="Design">🎨 Design</button>
        <button class="quick-action-btn" data-activity="Programming" data-tag="Programming">💻 Programming</button>
        <button class="quick-action-btn" data-activity="Product" data-tag="Product">📱 Product</button>
        <button class="quick-action-btn" data-activity="Admin" data-tag="Admin">📊 Admin</button>
        <button class="quick-action-btn" data-activity="Travel" data-tag="Travel">✈️ Travel</button>
        <button class="quick-action-btn" data-activity="Break" data-tag="Break">☕ Break</button>
        <button class="quick-action-btn" data-activity="Hiring" data-tag="Hiring">👥 Hiring</button>
        <button class="quick-action-btn" data-activity="Operations" data-tag="Operations">⚙️ Operations</button>
    </div>

    <div class="tag-summary collapsed">
        <h2>Time Distribution</h2>
        <div class="tag-stats"></div>
    </div>

    <div id="activities"></div>

    <script>
        // Get DOM elements
        const form = document.getElementById('activityForm');
        const input = document.getElementById('activityInput');
        const activitiesList = document.getElementById('activities');

        // Load activities from localStorage
        let activities = JSON.parse(localStorage.getItem('timeTrackerActivities')) || [];
        let tags = JSON.parse(localStorage.getItem('timeTrackerTags')) || [];

        // Format duration
        function formatDuration(startTime, endTime) {
            if (!endTime) return 'In Progress';
            
            const duration = new Date(endTime) - new Date(startTime);
            const hours = Math.floor(duration / (1000 * 60 * 60));
            const minutes = Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((duration % (1000 * 60)) / 1000);

            if (hours > 0) {
                return `${hours}h ${minutes}m ${seconds}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            } else {
                return `${seconds}s`;
            }
        }

        // Calculate duration in milliseconds
        function getDurationMs(startTime, endTime) {
            if (!endTime) return 0;
            return new Date(endTime) - new Date(startTime);
        }

        // Format duration from milliseconds
        function formatDurationFromMs(duration) {
            const hours = Math.floor(duration / (1000 * 60 * 60));
            const minutes = Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else {
                return `${minutes}m`;
            }
        }

        // Display activities
        function displayActivities() {
            activitiesList.innerHTML = activities
                .map((activity, index) => `
                    <div class="activity ${!activity.ended_at ? 'active' : 'completed'}" data-index="${index}">
                        <div class="activity-content">
                            <div class="activity-text">${activity.text || 'No mission description'}</div>
                            <div class="timestamp">Started: ${new Date(activity.timestamp).toLocaleString()}</div>
                            ${activity.ended_at ? 
                                `<div class="timestamp">Ended: ${new Date(activity.ended_at).toLocaleString()}</div>` : 
                                ''}
                            <div class="duration">Duration: ${formatDuration(activity.timestamp, activity.ended_at)}</div>
                            <div class="tags">
                                ${(activity.tags || []).map(tag => `
                                    <span class="tag">
                                        ${tag}
                                        <span class="tag-remove" data-tag="${tag}">×</span>
                                    </span>
                                `).join('')}
                            </div>
                            <div class="tag-input-container">
                                <input type="text" class="tag-input" placeholder="Add tag...">
                                <div class="tag-suggestions"></div>
                            </div>
                        </div>
                        <div>
                            ${!activity.ended_at ? 
                                `<button class="stop-btn" title="End this mission">Stop</button>` : 
                                ''}
                            <button class="edit-btn">Edit</button>
                        </div>
                    </div>
                `)
                .join('');

            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', handleEditClick);
            });

            // Add event listeners to stop buttons
            document.querySelectorAll('.stop-btn').forEach(btn => {
                btn.addEventListener('click', handleStopClick);
            });

            // Add event listeners for tag functionality
            document.querySelectorAll('.activity').forEach(activityDiv => {
                const index = activityDiv.dataset.index;
                const activity = activities[index];
                const tagInput = activityDiv.querySelector('.tag-input');
                const tagSuggestions = activityDiv.querySelector('.tag-suggestions');
                const tagsContainer = activityDiv.querySelector('.tags');

                // Handle tag input
                tagInput.addEventListener('input', () => {
                    const value = tagInput.value.trim();
                    if (value) {
                        const suggestions = tags.filter(tag => 
                            tag.toLowerCase().includes(value.toLowerCase()) &&
                            !(activity.tags || []).includes(tag)
                        );
                        if (suggestions.length > 0) {
                            tagSuggestions.innerHTML = suggestions
                                .map(tag => `<div class="tag-suggestion">${tag}</div>`)
                                .join('');
                            tagSuggestions.style.display = 'block';
                        } else {
                            tagSuggestions.style.display = 'none';
                        }
                    } else {
                        tagSuggestions.style.display = 'none';
                    }
                });

                // Handle tag suggestion click
                tagSuggestions.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tag-suggestion')) {
                        const tag = e.target.textContent;
                        if (!(activity.tags || []).includes(tag)) {
                            if (!activity.tags) activity.tags = [];
                            activity.tags.push(tag);
                            tagsContainer.innerHTML += `
                                <span class="tag">
                                    ${tag}
                                    <span class="tag-remove" data-tag="${tag}">×</span>
                                </span>
                            `;
                        }
                        tagInput.value = '';
                        tagSuggestions.style.display = 'none';
                        localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));
                    }
                });

                // Handle tag removal
                tagsContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('tag-remove')) {
                        const tagToRemove = e.target.dataset.tag;
                        if (!activity.tags) activity.tags = [];
                        activity.tags = activity.tags.filter(tag => tag !== tagToRemove);
                        e.target.closest('.tag').remove();
                        localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));
                    }
                });

                // Handle tag input keydown
                tagInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && tagInput.value.trim()) {
                        const newTag = tagInput.value.trim();
                        if (!(activity.tags || []).includes(newTag)) {
                            if (!activity.tags) activity.tags = [];
                            activity.tags.push(newTag);
                            if (!tags.includes(newTag)) {
                                tags.push(newTag);
                                localStorage.setItem('timeTrackerTags', JSON.stringify(tags));
                            }
                            tagsContainer.innerHTML += `
                                <span class="tag">
                                    ${newTag}
                                    <span class="tag-remove" data-tag="${newTag}">×</span>
                                </span>
                            `;
                            localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));
                        }
                        tagInput.value = '';
                        tagSuggestions.style.display = 'none';
                    }
                });
            });

            updateTagSummary();
        }

        // Handle form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const activityText = input.value.trim();

            // End the current active task if there is one
            if (activities.length > 0 && !activities[0].ended_at) {
                activities[0].ended_at = new Date().toISOString();
            }

            // Create new activity
            const newActivity = {
                text: activityText,
                timestamp: new Date().toISOString(),
                ended_at: null,
                tags: []
            };

            // Add to activities array
            activities.unshift(newActivity);

            // Save to localStorage
            localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));

            // Update display
            displayActivities();

            // Clear input
            input.value = '';
        });

        // Handle quick action buttons
        document.querySelectorAll('.quick-action-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const activityText = btn.dataset.activity;
                const activityTag = btn.dataset.tag;

                // End the current active task if there is one
                if (activities.length > 0 && !activities[0].ended_at) {
                    activities[0].ended_at = new Date().toISOString();
                }

                // Create new activity
                const newActivity = {
                    text: activityText,
                    timestamp: new Date().toISOString(),
                    ended_at: null,
                    tags: [activityTag]  // Initialize with the activity tag
                };

                // Add tag to global tags if it doesn't exist
                if (!tags.includes(activityTag)) {
                    tags.push(activityTag);
                    localStorage.setItem('timeTrackerTags', JSON.stringify(tags));
                }

                // Add to activities array
                activities.unshift(newActivity);

                // Save to localStorage
                localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));

                // Update display
                displayActivities();
            });
        });

        // Handle stopping an activity
        function handleStopClick(e) {
            const activityDiv = e.target.closest('.activity');
            const index = activityDiv.dataset.index;
            activities[index].ended_at = new Date().toISOString();
            localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));
            displayActivities();
        }

        // Handle editing an activity
        function handleEditClick(e) {
            const activityDiv = e.target.closest('.activity');
            const index = activityDiv.dataset.index;
            const activity = activities[index];
            
            // Format the timestamp for the datetime-local input
            const timestamp = new Date(activity.timestamp);
            const year = timestamp.getFullYear();
            const month = String(timestamp.getMonth() + 1).padStart(2, '0');
            const day = String(timestamp.getDate()).padStart(2, '0');
            const hours = String(timestamp.getHours()).padStart(2, '0');
            const minutes = String(timestamp.getMinutes()).padStart(2, '0');
            const datetimeLocal = `${year}-${month}-${day}T${hours}:${minutes}`;

            // Format the end timestamp if it exists
            let endDateTimeLocal = '';
            if (activity.ended_at) {
                const endTimestamp = new Date(activity.ended_at);
                const endYear = endTimestamp.getFullYear();
                const endMonth = String(endTimestamp.getMonth() + 1).padStart(2, '0');
                const endDay = String(endTimestamp.getDate()).padStart(2, '0');
                const endHours = String(endTimestamp.getHours()).padStart(2, '0');
                const endMinutes = String(endTimestamp.getMinutes()).padStart(2, '0');
                endDateTimeLocal = `${endYear}-${endMonth}-${endDay}T${endHours}:${endMinutes}`;
            }
            
            // Replace content with edit form
            activityDiv.innerHTML = `
                <div class="activity-content">
                    <input type="text" class="edit-input" value="${activity.text || ''}" placeholder="What's your next mission?">
                    <div class="timestamp">Start Time:</div>
                    <input type="datetime-local" class="datetime-input start-time" value="${datetimeLocal}">
                    <div class="time-adjust-buttons">
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="-1" title="Rewind 1 minute">⏪1m</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="-5" title="Rewind 5 minutes">⏪5m</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="-15" title="Rewind 15 minutes">⏪15m</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="-30" title="Rewind 30 minutes">⏪30m</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="30" title="Forward 30 minutes">30m⏩</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="15" title="Forward 15 minutes">15m⏩</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="5" title="Forward 5 minutes">5m⏩</button>
                        <button type="button" class="time-adjust-btn" data-target="start" data-minutes="1" title="Forward 1 minute">1m⏩</button>
                    </div>
                    ${index > 0 || activity.ended_at ? `
                        <div class="timestamp">End Time:</div>
                        <input type="datetime-local" class="datetime-input end-time" value="${endDateTimeLocal || datetimeLocal}">
                        <div class="time-adjust-buttons">
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="-1" title="Rewind 1 minute">⏪1m</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="-5" title="Rewind 5 minutes">⏪5m</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="-15" title="Rewind 15 minutes">⏪15m</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="-30" title="Rewind 30 minutes">⏪30m</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="30" title="Forward 30 minutes">30m⏩</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="15" title="Forward 15 minutes">15m⏩</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="5" title="Forward 5 minutes">5m⏩</button>
                            <button type="button" class="time-adjust-btn" data-target="end" data-minutes="1" title="Forward 1 minute">1m⏩</button>
                        </div>
                    ` : ''}
                </div>
                <button class="save-btn">Save</button>
            `;

            // Add event listeners for time adjustment buttons
            activityDiv.querySelectorAll('.time-adjust-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.dataset.target;
                    const minutes = parseInt(btn.dataset.minutes);
                    const input = activityDiv.querySelector(`.${target}-time`);
                    
                    // Get current datetime from input
                    const currentDate = new Date(input.value);
                    // Add minutes
                    currentDate.setMinutes(currentDate.getMinutes() + minutes);
                    
                    // Format back to datetime-local string
                    const newYear = currentDate.getFullYear();
                    const newMonth = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const newDay = String(currentDate.getDate()).padStart(2, '0');
                    const newHours = String(currentDate.getHours()).padStart(2, '0');
                    const newMinutes = String(currentDate.getMinutes()).padStart(2, '0');
                    input.value = `${newYear}-${newMonth}-${newDay}T${newHours}:${newMinutes}`;
                });
            });

            // Add event listener to save button
            const saveBtn = activityDiv.querySelector('.save-btn');
            const editInput = activityDiv.querySelector('.edit-input');
            const startTimeInput = activityDiv.querySelector('.start-time');
            const endTimeInput = activityDiv.querySelector('.end-time');
            
            saveBtn.addEventListener('click', () => {
                activities[index].text = editInput.value.trim();
                // Convert the datetime-local values to ISO strings
                const newStartDate = new Date(startTimeInput.value);
                activities[index].timestamp = newStartDate.toISOString();
                
                if (endTimeInput) {
                    const newEndDate = new Date(endTimeInput.value);
                    // Only set ended_at if this isn't the currently active task (index > 0)
                    if (index > 0 || activities[index].ended_at) {
                        activities[index].ended_at = newEndDate.toISOString();
                    }
                }
                
                localStorage.setItem('timeTrackerActivities', JSON.stringify(activities));
                displayActivities();
            });
        }

        // Update tag summary
        function updateTagSummary() {
            const tagStats = {};
            let totalDuration = 0;
            let unclassifiedDuration = 0;

            // Calculate total time for each tag
            activities.forEach(activity => {
                if (!activity.ended_at) return; // Skip active tasks
                const duration = getDurationMs(activity.timestamp, activity.ended_at);
                
                if (!activity.tags || activity.tags.length === 0) {
                    unclassifiedDuration += duration;
                } else {
                    activity.tags.forEach(tag => {
                        tagStats[tag] = (tagStats[tag] || 0) + duration;
                    });
                }
                
                totalDuration += duration;
            });

            // Add unclassified to tagStats if there are any
            if (unclassifiedDuration > 0) {
                tagStats['Unclassified'] = unclassifiedDuration;
            }

            // Generate HTML for tag stats
            const tagStatsHtml = Object.entries(tagStats)
                .sort((a, b) => b[1] - a[1]) // Sort by duration descending
                .map(([tag, duration]) => {
                    const percentage = totalDuration ? (duration / totalDuration * 100).toFixed(1) : 0;
                    const tagColor = getTagColor(tag);
                    return `
                        <div class="tag-stat" style="border-left-color: ${tagColor}">
                            <div class="tag-stat-header">
                                <span class="tag-stat-name">${tag}</span>
                                <span class="tag-stat-time">${formatDurationFromMs(duration)} (${percentage}%)</span>
                            </div>
                            <div class="tag-stat-bar">
                                <div class="tag-stat-fill" style="width: ${percentage}%; background: ${tagColor}"></div>
                            </div>
                        </div>
                    `;
                })
                .join('');

            document.querySelector('.tag-stats').innerHTML = tagStatsHtml;
        }

        // Get a consistent color for a tag
        function getTagColor(tag) {
            const colors = {
                'Design': '#FF6B6B',
                'Programming': '#4ECDC4',
                'Product': '#45B7D1',
                'Admin': '#96CEB4',
                'Travel': '#FFEEAD',
                'Break': '#D4A5A5',
                'Hiring': '#9B59B6',
                'Operations': '#3498DB',
                'Unclassified': '#95A5A6'  // A neutral gray for unclassified tasks
            };
            
            return colors[tag] || '#ff4d4d';
        }

        // Add click handler for tag summary collapse/expand
        document.querySelector('.tag-summary h2').addEventListener('click', function() {
            const summary = this.closest('.tag-summary');
            summary.classList.toggle('collapsed');
            
            // Store preference in localStorage
            localStorage.setItem('tagSummaryCollapsed', summary.classList.contains('collapsed'));
        });

        // Restore collapse state from localStorage
        const tagSummaryCollapsed = localStorage.getItem('tagSummaryCollapsed') === 'true';
        document.querySelector('.tag-summary').classList.toggle('collapsed', tagSummaryCollapsed);

        // Initial display
        displayActivities();
    </script>
</body>
</html> 